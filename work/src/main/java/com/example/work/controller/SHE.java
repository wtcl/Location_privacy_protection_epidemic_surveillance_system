package com.example.work.controller;

import java.math.BigInteger;
import java.util.Random;

public class SHE{
	public int k0 = 1024;
	public int k1 = 40;
	public int k2 = 100;
	
	public BigInteger p = new BigInteger("103208146936017409001064853981771185455864998286468294292021651567093072755391006690797243062245227974110161616783290449963036069502455840116375500599809354378065508136232575810480600455008819848432899485314223940884758720245320373749115428478542050852778707911799037417936981398197252130697237545750626590533");
	public BigInteger q = new BigInteger("92500274593832986367397251378162856898838275239456223267003750596901351153941833991986120538983877035861510032124601559966888180086822596869763089693497173235432383986470751400008096226782421678729605536602796869447709469839623881733446440439628853239420308159705321567723006363118922973092807357378500861951");
	public BigInteger l = new BigInteger("1124127490067959807263446365663");
	
	public BigInteger N = new BigInteger("9546781931902272913828923724295801735314808738336117082299855267526370781255410204449406183189400394191553500504449780688226003981177767136688893176578431780322420126401247136429165105301768530585293216949048184660695178056521666063185594615709133221269883743509535638513583807607257049234822319285931079665127506948312293265462750992730487096731909922004955846964412738284005178524252365786602967132981374441626648735927147993313988069522138931741286006285375781327263105630906425730759283730995117116175980110578844530483675184106347643567976063814425010197997214633010035560584865048895967251500913096080836509883");

	public void SHEInitialization(int k0, int k1, int k2)
	{
		/*
		Random rnd = new Random();
		this.p = BigInteger.probablePrime(k0, rnd);
		this.q = BigInteger.probablePrime(k0, rnd);
		this.l = new BigInteger(k2, rnd);
		this.N = this.p.multiply(this.q); */

		this.k0 = k0;
		this.k1 = k1;
		this.k2 = k2;
	}
	
	public BigInteger SHEEncryption(BigInteger plaintext)
	{
		Random rnd = new Random();
		BigInteger r0 = new BigInteger(this.k2, rnd);
		BigInteger r1 = new BigInteger(this.k0, rnd);
		
		BigInteger tmp1 = ((r0.multiply(this.l).mod(this.N)).add(plaintext)).mod(this.N);
		BigInteger tmp2 = ((r1.multiply(this.p).mod(this.N)).add(BigInteger.ONE)).mod(this.N);
		return (tmp1.multiply(tmp2)).mod(this.N);
	}
	
	public BigInteger SHEDecryption(BigInteger ciphertext)
	{

		BigInteger plaintext = (ciphertext.mod(this.p)).mod(this.l);
		if(plaintext.compareTo(l.divide(new BigInteger("2"))) >= 0){
			plaintext = plaintext.subtract(l);
		}
		return plaintext;
	}

	public Integer SHECompare(BigInteger c1, BigInteger c2){
		return SHEDecryption(c1).subtract(SHEDecryption(c2)).compareTo(BigInteger.ZERO);
	}

	public static BigInteger SHEAdd(BigInteger ctxt1, BigInteger ctxt2){
		return ctxt1.add(ctxt2);
	}
	
	public static BigInteger SHEMul(BigInteger ctxt1, BigInteger ctxt2){
		return ctxt1.multiply(ctxt2);
	}
	public static BigInteger SHESubtract(BigInteger ctxt1, BigInteger ctxt2){
		return ctxt1.subtract(ctxt2);
	}

	
	public static void main(String[] args)
	{
		SHE she = new SHE();
		System.out.println("--------------------系统初始化--------------------");
		System.out.println("k0: "+she.k0);
		System.out.println("k1: "+she.k1);
		System.out.println("k2: "+she.k2);
		System.out.println("n: "+she.N);
		System.out.println("length: "+she.l);
		System.out.println("p: "+she.p);
		System.out.println("q: "+she.q);
		System.out.println("-------------------参数设置完成--------------------");

//		String[] data= new String[]{"31595390248227980176651759944969637113496133969429200703553727026578376742765134049416215776824631657936519677853602606603644053083988162853495378863804151267981722557865848697024161279367500661733745590294477654077189546550996697397337990866688562235840090110628216184893680179242359640874539326822781719572902792319402853835288661705676806731798624768077673278303638604589311542968708250565986432611002116415125263389968343270388713950671224465321641878652117087199806322224831634551413184530357369200088336013357018766905737176156773849226436021932159292227651219771106314504704357811055233906159168415804815949413246106618350497104108008976375400151792232217496395790803720083351637450863063951960766191695465569094756204032941437851073655202019131766752354635011549801528574414045655655057005140383192447979794313365881427551703554682235830986507173356185813596200066508539430908008064238347685450327333238539908681025942008433787096562044045281772444980687558364493101524108490166753796246023369047844029646412829351873580847441607477822110156790218632152865320335045585351979646161376657821838648193569836681272660692207578766142257881954608744125534709276322853378771238248321246656208613002836979338992915905958753697322970", "15686220172977879544636764241063025979291521069314594920577071220680571688840893976127175681200561770364565905672390130711539881893043498207859349501179237868827351159213156343035781098544190890446377135968564231588064099719293039693019254635567102199995603682116993458630700471415382895117496753380255728337853749526553327337359972876830768241331280344856961792499130240529667841434063178092346771961594135517472391793435273151348290423106122087833579684126313646495757510371953576360757027221266325597558832895153315912898972494461517489817718581355145157379605874694145754554419507503536448480078034918165385458583566698386935075254437230573268004167551903621125397893211646999936848637984354542985896692615309346987648913767410259527004406093350524774228977569010219383708870506116327950196431064040091790012726241666308051878074240838534561331596899060235635080585705166169911593558674454919653561294439114270487817719875945223350214738247979855810721142017788081787793661718855819659625905581488765115121209064376258540074167165793072204382325795267440299480749725587238991053003562158820691510716066997483009204882910307446832122558911914450205220713968954786445359393248875255064291115415644591786026432602275010709919549946", "14854806173617421308780089996971213513488992863223548338448725429019613991049292280101004871584421073364460911965177761455646817719174024865927878690784904306306036664628711830241864970943545451731966035033441480496246077561146628657883121863035481298098541130381290398920730443887417260982581505732667796381410515530430958268587177993828516379115124591834686517833653546736951835257539189049261217215581613993377441307543847763259837655240315018307653214374046781648394309847543548818779388942400792903793095246785874732031863918591468213073102082518526865012134061006370783034146253236744337053115584533405038656471380119444183064028917459570390474307391440128481654873909967300356134378609475567850086417766759879969844662414604555019344933815056877653977745862192138814740857925063803278430423171684759564143714071491741057528833626455709441692773428004882991132871042896806807466072677284475862687042705694773255883153822081127230113469656572632065800931468722849258613386249179748481028212625135537408238071073009895495739020945297133730075993509673270657082499198536909573229432202009806884577675531162202792999970338053041552598437351756531079963200557502061889615777363134073224500003002585613074185693980130863942234497365", "3484040221534500742330797333649400175013830241709023688552011065507538013401019246717296395118747519041517779658226675903710892325962474252404927934984023183926735402738067914547238912832432026315077558677147224653763732732604076095384325170918106004495589874551800309880377752410381063145460832820517583510375794434905950517916098399262704925830597646869502658542433062133132885330685461964540882705086368970050293728004884521677154069995413983454272902294452061892711672031711893895932906905712845467555836679725548825647995665882525704338724557296975464098962374057803195381985810583629890555868191621331009958780660347673139350996226576780111702435414775228866189865552281081511938039714866961811652664566796159305334908991519356778684248795269008477820083026569959074019166777233786444868538024164324440846951693572246948075897786455750926327855831068679486015218355577178689046832317732880790741623578021093041236092315112108175019441374458565110177995468577552465095747271820074878440578812954247322860130823849354536141747833375107974413085522795250698984132405145908443299216565357942973791918740098972677136006931064222423271808436040941405096644656911709900171728195708549463441908136432930894816475376728585566165397404"};
//		for(int i=0; i<4; i++){
//			System.out.println(she.SHEDecryption(new BigInteger(data[i])));
//		}

//		she.SHEInitialization(1024, 40, 100);
//		System.out.println(she.p.toString());
//		BigInteger ciphertext = BigInteger.ONE;
//		BigInteger plaintext = BigInteger.ONE;
//		BigInteger ciphertext1 = BigInteger.ONE;
//		ciphertext = she.SHEEncryption(new BigInteger("1"));
//		ciphertext1 = she.SHEEncryption(new BigInteger("1024"));
//		System.out.println(ciphertext);
//		System.out.println(ciphertext1);
//		plaintext = she.SHEDecryption(ciphertext);
//		System.out.println(plaintext);
//		StringBuilder stringBuilder = new StringBuilder();
//		for(int i = 0; i<1000000; i++){
//			ArrayList<List<String>> dis = new ArrayList<>();
//			List<String> d = new ArrayList<>();
//			Random random = new Random();
//			d.add(she.SHEEncryption(new BigInteger(String.valueOf(random.nextInt(100000000)))).toString());
//			d.add(she.SHEEncryption(new BigInteger(String.valueOf(random.nextInt(100000000)))).toString());
//			dis.add(d);
//			Map<String, ArrayList<List<String>>> rawMap = new HashMap<>();
//			rawMap.put("data", dis);
//			LinkedMultiValueMap<String, String> map = new LinkedMultiValueMap<>();
//			map.add("data",  JSONObject.toJSONString(rawMap));
//			WebClient client = WebClient.create();
//			@SuppressWarnings("rawtypes")
//			Flux<Map> mapFlux = client.post().uri("http://127.0.0.1:8080/api").contentType(MediaType.APPLICATION_FORM_URLENCODED).body(BodyInserters.fromFormData("data",JSONObject.toJSONString(rawMap))).retrieve().bodyToFlux(Map.class);
//			mapFlux.collectList().subscribe(maps -> {
//				String result = (String) maps.get(0).get("res");
//				stringBuilder.append(result+",");});
//		}
//		System.out.println(stringBuilder.toString());
	}

}
